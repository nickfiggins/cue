exec cue cmd run
cmp stdout run_golden_bytes.txtar
exec cue cmd runBytes
cmp stdout run_golden_bytes.txtar
exec cue cmd runErr
cmp stdout runerr_golden.txtar
exec cue cmd runErrBytes
cmp stdout runerr_golden.txtar
-- task.cue --
package home
message: "Hello world!"

-- task_tool.cue --
package home

command: run: #RunBase & {
	task: echo: cmd: "echo \(message)"
}

command: runBytes: #RunBaseBytes & {
	task: echo: cmd: "echo \(message)"
}

command: runErr: #RunBase & {
	task: echo: cmd: "false"
}

command: runErrBytes: #RunBaseBytes & {
	task: echo: cmd: "false"
}

-- run_golden_string.txtar --
stdout: Hello world!

stderr:
-- run_golden_bytes.txtar --
stdout: Hello world!

stderr:
-- runerr_golden.txtar --
stdout:
stderr: exit status 1
-- base_tool.cue --
package home

import (
	"tool/cli"
	"tool/exec"
)

// deliberately put in another file to test resolving top-level identifiers
// in different files.
#RunBase: {
	task: echo: exec.Run & {
		stdout: string
		stderr: string
		mustSucceed: false
	}

	task: display: cli.Print & {
		text: """
		stdout: \( *"empty" | task.echo.stdout)
		stderr: \( *"empty" | task.echo.stderr)
		"""
	}
}

#RunBaseBytes: {
	task: echo: exec.Run & {
		stdout: bytes
		stderr: bytes
		mustSucceed: false
	}

	task: display: cli.Print & {
		text: """
		stdout: \(*"empty" | task.echo.stdout)
		stderr: \(*"empty" | task.echo.stderr)
		"""
	}
}
